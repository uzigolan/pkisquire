{% extends "layout.html" %}
{% block content %}
  <div class="d-flex justify-content-between align-items-start mb-4">
    <h1 class="mb-0">Key Details (ID: {{ key.id }})</h1>
    <a href="{{ url_for('keys.list_keys') }}" class="btn btn-secondary">Back to Keys List</a>
  </div>
  <p><strong>Name:</strong> {{ key.name }}</p>
  <p><strong>Type:</strong> {{ key.key_type }}</p>

  {% if key.key_type == "RSA" %}
    <p><strong>Size:</strong> {{ key.key_size }} bits</p>
  {% elif key.key_type == "EC" %}
    <p><strong>Curve:</strong> {{ key.curve_name }}</p>
  {% elif key.key_type == "PQC" %}
    <p><strong>Algorithm:</strong> {{ key.pqc_alg }}</p>
  {% endif %}

  <p><strong>Created At:</strong> {{ key.created_at.strftime('%Y-%m-%d %H:%M') }}</p>

  <div class="row">
    <div class="col-12 col-lg-6">
      <h2 class="mt-4">Public Key</h2>
      <ul class="nav nav-tabs" id="publicKeyTabs" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" id="public-pkcs8-tab" data-toggle="tab" href="#public-pkcs8" role="tab" aria-controls="public-pkcs8" aria-selected="true">PKCS8</a>
        </li>
        {% if key.key_type != "PQC" and key.curve_name != "secp256k1" %}
          <li class="nav-item">
            <a class="nav-link" id="public-rfc4716-tab" data-toggle="tab" href="#public-rfc4716" role="tab" aria-controls="public-rfc4716" aria-selected="false">SSH2</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="public-rfc4716-bare-tab" data-toggle="tab" href="#public-rfc4716-bare" role="tab" aria-controls="public-rfc4716-bare" aria-selected="false">SSH2 (bare)</a>
          </li>
        {% endif %}
      </ul>
      <div class="tab-content border border-top-0 p-3" id="publicKeyTabsContent">
        <div class="tab-pane fade show active" id="public-pkcs8" role="tabpanel" aria-labelledby="public-pkcs8-tab">
          <div class="d-flex justify-content-start">
            <button type="button" class="btn btn-sm btn-outline-secondary" data-copy-target="key-public-pkcs8-pre">Copy</button>
          </div>
          <pre id="key-public-pkcs8-pre">{{ key.public_key }}</pre>
        </div>
        {% if key.key_type != "PQC" and key.curve_name != "secp256k1" %}
          <div class="tab-pane fade" id="public-rfc4716" role="tabpanel" aria-labelledby="public-rfc4716-tab">
            {% if rfc4716_public %}
              <div class="d-flex justify-content-start">
                <button type="button" class="btn btn-sm btn-outline-secondary" data-copy-target="key-public-rfc4716-pre">Copy</button>
              </div>
              <pre id="key-public-rfc4716-pre">{{ rfc4716_public }}</pre>
            {% else %}
              <p><em>SSH2 unavailable{% if format_errors.rfc4716_public %}: {{ format_errors.rfc4716_public }}{% endif %}</em></p>
            {% endif %}
          </div>
          <div class="tab-pane fade" id="public-rfc4716-bare" role="tabpanel" aria-labelledby="public-rfc4716-bare-tab">
            {% if rfc4716_public_bare %}
              <div class="d-flex justify-content-start">
                <button type="button" class="btn btn-sm btn-outline-secondary" data-copy-target="key-public-rfc4716-bare-pre">Copy</button>
              </div>
              <pre id="key-public-rfc4716-bare-pre">{{ rfc4716_public_bare }}</pre>
            {% else %}
              <p><em>SSH2 (bare) unavailable{% if format_errors.rfc4716_public %}: {{ format_errors.rfc4716_public }}{% endif %}</em></p>
            {% endif %}
          </div>
        {% endif %}
      </div>
    </div>

    <div class="col-12 col-lg-6">
      <h2 class="mt-4">Private Key</h2>
      <ul class="nav nav-tabs" id="privateKeyTabs" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" id="private-pkcs8-tab" data-toggle="tab" href="#private-pkcs8" role="tab" aria-controls="private-pkcs8" aria-selected="true">PKCS8</a>
        </li>
        {% if key.key_type == "RSA" %}
          <li class="nav-item">
            <a class="nav-link" id="private-pkcs1-tab" data-toggle="tab" href="#private-pkcs1" role="tab" aria-controls="private-pkcs1" aria-selected="false">PKCS1</a>
          </li>
        {% endif %}
      </ul>
      <div class="tab-content border border-top-0 p-3" id="privateKeyTabsContent">
        <div class="tab-pane fade show active" id="private-pkcs8" role="tabpanel" aria-labelledby="private-pkcs8-tab">
          <div class="d-flex justify-content-start">
            <button type="button" class="btn btn-sm btn-outline-secondary" data-copy-target="key-private-pkcs8-pre">Copy</button>
          </div>
          <pre id="key-private-pkcs8-pre">{{ key.private_key }}</pre>
        </div>
        {% if key.key_type == "RSA" %}
          <div class="tab-pane fade" id="private-pkcs1" role="tabpanel" aria-labelledby="private-pkcs1-tab">
            {% if pkcs1_private %}
              <div class="d-flex justify-content-start">
                <button type="button" class="btn btn-sm btn-outline-secondary" data-copy-target="key-private-pkcs1-pre">Copy</button>
              </div>
              <pre id="key-private-pkcs1-pre">{{ pkcs1_private }}</pre>
            {% else %}
              <p><em>PKCS1 unavailable{% if format_errors.pkcs1_private %}: {{ format_errors.pkcs1_private }}{% endif %}</em></p>
            {% endif %}
          </div>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock %}

