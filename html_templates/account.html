{% extends "layout.html" %}
{% block content %}
<div class="container mt-4">
  <h2>Account</h2>
  <div class="card mb-4">
    <div class="card-header">Change Password</div>
    <div class="card-body">
      {% if current_user.auth_source != 'ldap' %}
      <form method="POST" action="{{ url_for('change_password') }}">
        <div class="form-group">
          <label for="current_password">Current Password</label>
          <input type="password" class="form-control" id="current_password" name="current_password" required>
        </div>
        <div class="form-group">
          <label for="new_password">New Password</label>
          <input type="password" class="form-control" id="new_password" name="new_password" required>
        </div>
        <div class="form-group">
          <label for="confirm_password">Confirm New Password</label>
          <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
        </div>
        <button type="submit" class="btn btn-primary">Change Password</button>
      </form>
      {% else %}
      <div class="alert alert-info mb-0">Password changes are managed by your LDAP/Active Directory administrator.</div>
      {% endif %}
    </div>
  </div>
  <div class="card mb-4">
    <div class="card-header">API Tokens</div>
    <div class="card-body">
      <p class="mb-2">Create and manage personal API tokens for automated access.</p>
      <a href="{{ url_for('users.api_tokens') }}" class="btn btn-primary">Manage API Tokens</a>
    </div>
  </div>
  <div class="card mb-4">
    <div class="card-header">Appearance</div>
    <div class="card-body">
      <form method="POST" action="{{ url_for('account_theme') }}">
        <div class="form-group">
          <label for="theme_style">Theme style</label>
          <select id="theme_style" name="theme_style" class="form-control">
            <option value="modern" {% if theme_style == 'modern' %}selected{% endif %}>Modern</option>
            <option value="classic" {% if theme_style == 'classic' %}selected{% endif %}>Classic</option>
          </select>
        </div>
        <div class="form-group" id="theme-color-group">
          <label for="theme_color">Theme color</label>
          <select id="theme_color" name="theme_color" class="form-control">
            <option value="snow" {% if theme_color == 'snow' %}selected{% endif %}>Snow</option>
            <option value="midnight" {% if theme_color == 'midnight' %}selected{% endif %}>Midnight</option>
          </select>
          <small class="form-text text-muted">Theme color is available for Modern only.</small>
        </div>
        <button type="submit" class="btn btn-primary">Save Theme</button>
      </form>
    </div>
  </div>
  <div class="card">
    <div class="card-header">Logout</div>
    <div class="card-body">
      <a href="{{ url_for('users.logout') }}" class="btn btn-danger">Logout</a>
    </div>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script>
  function toggleThemeColor() {
    var styleSelect = document.getElementById('theme_style');
    var colorGroup = document.getElementById('theme-color-group');
    if (!styleSelect || !colorGroup) return;
    var isModern = styleSelect.value === 'modern';
    colorGroup.style.display = isModern ? 'block' : 'none';
  }

  document.addEventListener('DOMContentLoaded', toggleThemeColor);
  document.getElementById('theme_style').addEventListener('change', toggleThemeColor);
</script>
{% endblock %}
