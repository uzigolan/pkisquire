{% extends "layout.html" %}
{% block content %}
  <h1 class="mb-4">Manage Server Extension Configuration</h1>
  <form method="POST" action="{{ url_for('server_ext') }}" class="mb-4">
    <div class="form-group">
      <textarea id="server_ext_config" name="server_ext_config" rows="10" class="form-control" placeholder="Edit server extension configuration...">{{ server_ext_config }}</textarea>
    </div>
    {% if is_admin %}
    <div class="form-check mb-2">
      <input class="form-check-input" type="checkbox" id="save_system_default" name="save_system_default">
      <label class="form-check-label" for="save_system_default">Save as system default</label>
    </div>
    {% endif %}
    <button type="submit" class="btn btn-primary">Save User Configuration</button>
  </form>

  <h2>Load Configuration from a Saved Profile</h2>
  <div class="form-inline mb-4">
    <select id="profile_select" class="form-control mr-2">
      {% for profile in profiles %}
        <option value="{{ profile.name }}">{{ profile.name }}{% if profile.template_name %} (from {{ profile.template_name }}){% endif %}</option>
      {% endfor %}
    </select>
    <button type="button" class="btn btn-outline-secondary" onclick="loadProfile()">Load Profile Configuration</button>
  </div>

  <script>
    function loadProfile(){
      var select = document.getElementById('profile_select');
      var selectedFilename = select.options[select.selectedIndex].value;
      var xhr = new XMLHttpRequest();
      xhr.onreadystatechange = function(){
          if(xhr.readyState === XMLHttpRequest.DONE){
              if(xhr.status === 200){
                  document.getElementById('server_ext_config').value = xhr.responseText;
              } else {
                  alert("Error loading profile configuration: " + xhr.statusText);
              }
          }
      };
      xhr.open("GET", "/load_profile?filename=" + encodeURIComponent(selectedFilename), true);
      xhr.send();
    }
  </script>
  <a href="/" class="btn btn-secondary">‚Üê Back to Home</a>
{% endblock %}

