{% extends "layout.html" %}
{% block content %}
  <h1 class="mb-4">{% if not filename %}Create Profile{% else %}Edit Profile: {{ filename }}{% endif %}</h1>

  <form method="post" class="mb-4">
    <div class="form-group">
      {% if not filename %}
        <label for="filename">Profile Name:</label>
        <input type="text" class="form-control" name="filename" pattern="^[\w\-.]+$" required title="Must contain only letters, numbers, dots, dashes, and underscores" data-testid="input-profile-name">
      {% else %}
        <input type="hidden" name="filename" value="{{ filename }}">
        <h5>Editing: {{ filename }}</h5>
      {% endif %}
    </div>
    {% if not filename %}
    <div class="form-group">
      <label for="profile_type">Profile Type:</label>
      <input list="profile_types" class="form-control" name="profile_type" value="{{ profile_type }}" required>
      <datalist id="profile_types">
        {% for pt in existing_types %}
          <option value="{{ pt }}">
        {% endfor %}
      </datalist>
    </div>
    {% endif %}
    <div class="form-group">
      <label for="file_content">Profile Content:</label>
      <textarea class="form-control" name="file_content" rows="20">{{ file_content }}</textarea>
    </div>
    <button type="submit" class="btn btn-primary" data-testid="btn-save-profile">
      {% if not filename %}Create{% else %}Save{% endif %}
    </button>
    <a href="{% if filename %}{{ url_for('profiles.view_profile', name=filename) }}{% else %}{{ url_for('profiles.list_profiles') }}{% endif %}"
       class="btn btn-secondary ml-2">
      Cancel
    </a>
  </form>
{% endblock %}

